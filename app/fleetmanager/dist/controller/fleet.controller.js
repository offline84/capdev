sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/m/Dialog","sap/m/MessageToast","sap/m/MessageBox","../utils/validator","sap/ui/model/json/JSONModel","sap/ui/core/format/DateFormat"],function(e,t,i,a,o,l,n,r,s,g){"use strict";var c=e.extend("fleetmanager.controller.fleet",{onInit(){var e={VIN_NUMBER:"",BRAND:"",MODEL:"",COLOR:"",TYPE_OF_CAR:"",FIRST_USE:null};var t=new s(e);this.getView().setModel(t,"vehicleModel");var i={VIN_NUMBER_STATE_TEXT:"",VIN_NUMBER_STATE:"None",BRAND_STATE_TEXT:"",BRAND_STATE:"None",MODEL_STATE_TEXT:"",MODEL_STATE:"None"};var a=new s(i);this.getView().setModel(a,"vehicleStateModel");var o={maxDate:new Date};var l=new s(o);this.getView().setModel(l,"dateModel");var n={VIN_NUMBER:false,BRAND:false,MODEL:false,COLOR:false,TYPE_OF_CAR:false,FIRST_USE:false};var r=new s(n);this.getView().setModel(r,"editableInput")},onSearch:function(e){var a=e.getSource().getValue();if(a||a==""){var o=new t({filters:[new t({path:"MODEL",operator:i.Contains,value1:a,caseSensitive:false},i.Contains,a),new t({path:"BRAND",operator:i.Contains,value1:a,caseSensitive:false},i.Contains,a),new t({path:"COLOR",operator:i.Contains,value1:a,caseSensitive:false},i.Contains,a),new t({path:"TYPE_OF_CAR",operator:i.Contains,value1:a,caseSensitive:false},i.Contains,a),new t({path:"VIN_NUMBER",operator:i.Contains,value1:a,caseSensitive:false},i.Contains,a)]});var l=this.byId("fleetmanagerTable");var n=l.getBinding("items");n.filter(o,"Application")}},onPressNewVehicleButton:function(){if(!this.oDialog){this.oDialog=this.loadFragment({name:"fleetmanager.fragment.newVehicleDialog"})}this.oDialog.then(function(e){e.open()})},onSubmitPressed:function(){var e=this.getView().getModel("vehicleModel");let t=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"});var i=null;if(e.getProperty("/FIRST_USE")){i=t.format(e.getProperty("/FIRST_USE"))}var a={MODEL:e.getProperty("/MODEL"),BRAND:e.getProperty("/BRAND"),COLOR:e.getProperty("/COLOR"),TYPE_OF_CAR:e.getProperty("/TYPE_OF_CAR"),VIN_NUMBER:e.getProperty("/VIN_NUMBER"),FIRST_USE:i};var o=this.getView().byId("fleetmanagerTable").getBinding("items");if(a.VIN_NUMBER!=""&&a.MODEL!=""&&a.BRAND!=""){try{o.create(a)}catch(e){n.error("An error has occured during creation of the new Vehicle: /n",e)}this.byId("newVehicleDialog").close();for(const[t,i]of Object.entries(a)){if(t=="FIRST_USE"){e.setProperty("/"+t,null)}else e.setProperty("/"+t,"")}}else n.warning("New vehicle contains invalid fields!")},onChangeVinNumber:function(e){var t=r.validateVinNumber(e.getParameter("value"));this.getView().getModel("vehicleStateModel").setProperty("/VIN_NUMBER_STATE",t?"Error":"None");this.getView().getModel("vehicleStateModel").setProperty("/VIN_NUMBER_STATE_TEXT",t?t:null)},onChangeModel:function(e){var t=r.validateModel(e.getParameter("value"));this.getView().getModel("vehicleStateModel").setProperty("/MODEL_STATE",t?"Error":"None");this.getView().getModel("vehicleStateModel").setProperty("/MODEL_STATE_TEXT",t?t:null)},onChangeBrand:function(e){var t=r.validateModel(e.getParameter("value"));this.getView().getModel("vehicleStateModel").setProperty("/BRAND_STATE",t?"Error":"None");this.getView().getModel("vehicleStateModel").setProperty("/BRAND_STATE_TEXT",t?t:null)},onNewVehicleDialogCancelled:function(){this.byId("newVehicleDialog").close();l.show("No vehicle was added")},onDeleteSingleVehiclePressed:function(e){var t=e.getSource().getBindingContext();var i=t.getObject();n.warning("Are you sure you want to delete vehicle "+i.BRAND+" "+i.MODEL+"?",{actions:[n.Action.DELETE,n.Action.CANCEL],emphasizedAction:n.Action.DELETE,onClose:function(e){if(e==="DELETE"){t.delete();if(!t.hasPendingChanges()){l.show("Vehicle was successfully deleted")}}}});this._ViewDetailsDialog.close()},onShowDetailsSingleVehiclePressed:function(e){if(!this._ViewDetailsDialog){this.viewDetailsDialog="detailsVehicleDialog";this._ViewDetailsDialog=new sap.ui.xmlfragment(this.viewDetailsDialog,"fleetmanager.fragment.detailsVehicleDialog",this);this.getView().addDependent(this._ViewDetailsDialog)}var t=e.getSource().getBindingContext();let i=t.getObject();let a=i.FIRST_USE;if(a){i.FIRST_USE=new Date(a)}var o=new s(i);this._ViewDetailsDialog.setBindingContext(t);this._ViewDetailsDialog.setModel(o,"detailsVehicleModel");let l=this.getView().getModel("editableInput");for(const[e,t]of Object.entries(i)){if(t==""||t==null){l.setProperty("/"+e,true)}else{l.setProperty("/"+e,false)}}this._ViewDetailsDialog.open()},onDetailsVehicleDialogClosePressed:function(){this._ViewDetailsDialog.close()},onEditVehiclePressed:function(e){var t=e.getSource().getBindingContext();var i=this._ViewDetailsDialog.getModel("detailsVehicleModel");var a=t.getObject();let o=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"});var l=null;console.log(i.getProperty("/FIRST_USE"));if(i.getProperty("/FIRST_USE")){l=o.format(i.getProperty("/FIRST_USE"));i.setProperty("/FIRST_USE",l)}for(const[e,o]of Object.entries(a)){let a=i.getProperty("/"+e);if(a!=o){try{t.setProperty(e,i.getProperty("/"+e))}catch(e){n.error("Updating vehicle encountered an error: /n"+e)}}}}});return c});